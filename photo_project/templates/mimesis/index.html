{% extends "mimesis/base.html" %}

{% load thumbnail %}
{% load pagination_tags %}
{% load uni_form_tags %}

{% block body %}
    <h1>Photos</h1>

    <h2>Upload</h2>

    {% if MIMESIS_USE_FLASH_UPLOAD %}
        <div id="uploadify" class="multi-file-upload">
            <input id="fileInput" name="fileInput" type="file" />
        </div>
    {% else %}    
        <form action="{% url mimesis_upload_start_url %}" 
              method="POST"
              accept-charset="utf-8"
              enctype="multipart/form-data">
            
            {% csrf_token %}
            
            <input id="Filedata" name="Filedata" type="file" /><br />
            <input id="Filedata2" name="Filedata2" type="file" /><br />
            <input id="Filedata3" name="Filedata3" type="file" /><br />
            <input id="Filedata4" name="Filedata4" type="file" /><br />
    
            <p>
                <input type="submit" value="Upload">
            </p>
        </form>
    {% endif %}
    
    <br style="clear: all;" />

    {% if user_albums %}
        <h2>Your Albums</h2>
        
        {% autopaginate user_albums %}
        
        {% for album in user_albums %}
            <div>
                <a href="{% url mimesis_album album.id %}">
                    {% if album.key_photo %}
                        <img src="{% thumbnail album.key_photo.photo.name 192x192 crop %}"
                             title="{{ album.key_photo.name }}" />
                    {% else %}
                        {{ album.name }}
                    {% endif %}
                </a>
            </div>
        {% endfor %}
    
        {% paginate %}
    {% endif %}

    <br style="clear: all;" />
    
    {% if user_photos %}
        <h2>Your Photos</h2>
        
        {% autopaginate user_photos %}

        {% for photo in user_photos %}
            <div class="photo">
                <a href="{% url mimesis_photo photo.id %}">
                    <img src="{% thumbnail photo.photo.name 176x176 crop %}"
                         alt="{{ photo.name }}" />
                </a>
            </div>
        {% endfor %}
    
        {% paginate %}
    {% endif %}

    <br style="clear: all;" />

    {% if public_photos %}
        <h2>Everyone's Photos</h2>
        
        {% autopaginate public_photos %}

        {% for photo in public_photos %}
            <div class="photo">
                <a href="{% url mimesis_photo photo.id %}">
                    <img src="{% thumbnail photo.photo.name 176x176 crop %}"
                         alt="{{ photo.name }} by {{ photo.uploaded_by }}" />
                </a>
            </div>
        {% endfor %}
    
        {% paginate %}
    {% endif %}

{% endblock %}



{% block extra_body %}
    {{ block.super }}
    
    {% if MIMESIS_USE_FLASH_UPLOAD %}
        <script type="text/javascript" 
                src="{{ STATIC_URL }}js/uploadify/swfobject.js"></script>
        <script type="text/javascript" 
                src="{{ STATIC_URL }}js/uploadify/jquery.uploadify.js"></script>
        
        <script type="text/javascript" charset="utf-8">
            $(document).ready(function() {
                $('#fileInput').uploadify({
                    'uploader'  : '{{ STATIC_URL }}js/uploadify/uploadify.swf',
                    'script'    : '{% url mimesis_upload_start_url %}',
                    'scriptData': {'session_key': '{{ request.session.session_key }}'},
                    'cancelImg' : '{{ STATIC_URL }}js/uploadify/cancel.png',
                    'auto'      : true,
                    'folder'    : '{{ STATIC_URL }}uploads/',
                    'multi'     : true,
                    'onAllComplete' : allComplete
                });
            });

            function allComplete(event, data) {
                $('#uploadify').load('{% url mimesis_upload_complete_url %}', {
                    'filesUploaded': data.filesUploaded,
                    'errorCount': data.errors,
                    'allBytesLoaded': data.allBytesLoaded,
                    'speed': data.speed
                });
                // Raise custom event
                $('#uploadify').trigger('allUploadsComplete', data);
            }

        </script>
    {% endif %}
{% endblock %}